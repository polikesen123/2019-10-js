<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

</body>

</html>
<script src="./axios.js"></script>
<script>
    /* fetch 默认get请求  get需要传参数的时候  需自己拼接url   */
    // axios.get('./data.json',{params:{a:123,b:355}}).then((data)=>{
    //     console.log('axios',data)
    // },(err)=>console.log(err))
    // fetch('./data.json?a=12&b=13').then((data)=>{
    //     console.log('fetch',data);
    //     // return data.json();//把返回的结果转成JSON对象
    //     // return data.text();//把返回的结果转成字符串
    //     if(/[45]\d{2}/.test(data.status)){
    //         throw Error(data.statusText)
    //     }
    //     return data.json;
    // },(err)=>{
    //     console.log(err)
    // }).then((dat)=>{
    //     console.log(dat)
    // }).catch((er)=>{
    //     console.log(er)
    // })
    //fetch的post请求
    // fetch('./data.json', {
    //     method: 'post', //控制请求方式
    //     body: JSON.stringify({
    //         a: 12,
    //         b: 45
    //     }),
    //     credentials: 'same-origin', //include *omit
    //     //same-origin 同源可以携带cookie  
    //     //include 所有的请求都可以携带
    //     //omit 所有的都不可以携带
    //     headers: {
    //         //设置的请求头
    //         // 'Content-Type'

    //     }
    // }).then(data => {
    //     return data.json();
    //     // console.log('post-fetch',data)
    // }).catch(err => {
    //     console.log(err)
    // }).then((dat) => {
    //     console.log(666, dat)
    // }, err => {
    //     console.log(333, err)
    // })


    function http(url, options = {}) {
        let {
            method = 'get',
                data = {},
                headers = {},
                credentials = 'same-origin'
        } = options;
        let isGet = method.toLowerCase() == 'get'
        if (isGet) {
            //若是get请求 需要我们把data中的参数补成url后边的search字符串
            let str = '';
            for (let k in data) {
                str += `${k}=${data[k]}&`;
            }
            str = str.replace(/&$/, '');
            url = url.indexOf('?' == -1) ? (url + '?' + str) : (url + '&' + str);
        }
        return fetch(url, {
            method,
            body: isGet ? null : JSON.stringify(data),
            headers,
            credentials
        }).then((data) => {
            if (/[45]\d{2}/.test(data.status)) {
                throw Error(`${data.status} ${data.statusText}`)
            }
            return data.json();
        })
    }
    http.get= function(url,data){
        return http(url,{
            method:'get',
            data
        })
    }
    http.post= function(url,data){
        return http(url,{
            method:'post',
            data
        })
    }
    http('./data.json').then(data => {
        console.log(data)
    }, err => {
        console.log(err)
    })
    
    http('./data.json', {
        method: 'get',
        data: {
            a: 121,
            b: 3243
        },
        headers: {},
        credentials: 'same-origin'
    }).then((data) => {
        console.log(data)
    }, (err) => {
        console.log(err)
    })
</script>