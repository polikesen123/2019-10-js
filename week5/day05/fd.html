<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .box {
            width: 800px;
            height: 800px;
            overflow: hidden;
            user-select: none;
        }

        .box .litbox {
            width: 200px;
            height: 200px;
            border: 1px solid #333;
            position: relative;
            float: left;
        }

        .box .litbox img {
            width: 100%;
            height: 100%;
        }

        .box .litbox .mask {
            width: 100px;
            height: 100px;
            background: rgba(0, 0, 0, 0.3);
            position: absolute;
            left: 0;
            top: 0;
            display: none;
            cursor: move;
        }

        .box .bigbox {
            width: 300px;
            height: 300px;
            border: 1px solid red;
            float: left;
            overflow: hidden;
            position: relative;
            /* display: none; */
        }

        .box .bigbox img {
            width: 600px;
            height: 600px;
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>

<body>
    <div class="box" id="box">
        <div class="litbox">
            <img src="../day03/img/lit.jpg" alt="">
            <div class="mask"></div>
        </div>
        <!-- <div class="bigbox">
            <img src="./big.jpg" alt="">
        </div> -->
    </div>
</body>

<ml>
    <script>
        function fd(id) {
            let box = document.getElementById(id),
                litbox = box.getElementsByClassName('litbox')[0],
                mask = box.getElementsByClassName('mask')[0],
                bigbox = null,
                bigImg = null;
            litbox.onmouseenter = function () {
                mask.style.display = 'block';
                let div = document.createElement('div');
                div.className = 'bigbox';
                div.innerHTML = ` <img src="../day03/img/big.jpg" alt="">`;
                box.appendChild(div);
                bigbox = box.getElementsByClassName('bigbox')[0];
                bigImg = bigbox.getElementsByTagName('img')[0];
            }
            litbox.onmouseleave = function () {
                mask.style.display = 'none';
                box.removeChild(bigbox);
            }
            litbox.onmousemove = function (e) {
                let o = offset(this);
                // let l = o.l,t = o.t;
                let x = e.pageX - o.l,
                    y = e.pageY - o.t; //鼠标相对小盒子的距离
                let l = x - mask.offsetWidth / 2,
                    t = y - mask.offsetHeight / 2;
                let maxL = this.clientWidth - mask.clientWidth,
                    maxT = this.clientHeight - mask.clientHeight;
                l = l <= 0 ? 0 : (l >= maxL ? maxL : l)
                t = t <= 0 ? 0 : (t >= maxT ? maxT : t);
                mask.style.left = l + 'px';
                mask.style.top = t + 'px';
                let percent = bigImg.clientWidth / litbox.clientWidth;
                bigImg.style.left = -l * percent + 'px';
                bigImg.style.top = -t * percent + 'px';
            }

            function offset(ele) {
                let l = ele.offsetLeft;
                let t = ele.offsetTop;
                let temp = ele.offsetParent;
                while (temp) {
                    l += temp.offsetLeft + temp.clientLeft
                    t += temp.offsetTop + temp.clientTop;
                    temp = temp.offsetParent;
                }
                return {
                    l,
                    t
                }
            }
        }
        fd('box');
    </script>